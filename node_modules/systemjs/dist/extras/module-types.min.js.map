{"version":3,"file":"module-types.min.js","sources":["../../src/extras/module-types.js"],"sourcesContent":["/*\n * Loads JSON, CSS, Wasm module types based on file extension\n * filters and content type verifications\n */\n(function(global) {\n  var systemJSPrototype = global.System.constructor.prototype;\n\n  var moduleTypesRegEx = /^[^#?]+\\.(css|html|json|wasm)([?#].*)?$/;\n  systemJSPrototype.shouldFetch = function (url) {\n    return moduleTypesRegEx.test(url);\n  };\n\n  var jsonContentType = /^application\\/json(;|$)/;\n  var cssContentType = /^text\\/css(;|$)/;\n  var wasmContentType = /^application\\/wasm(;|$)/;\n\n  var fetch = systemJSPrototype.fetch;\n  systemJSPrototype.fetch = function (url, options) {\n    return fetch(url, options)\n    .then(function (res) {\n      if (!res.ok)\n        return res;\n      var contentType = res.headers.get('content-type');\n      if (jsonContentType.test(contentType))\n        return res.json()\n        .then(function (json) {\n          return new Response(new Blob([\n            'System.register([],function(e){return{execute:function(){e(\"default\",' + JSON.stringify(json) + ')}}})'\n          ], {\n            type: 'application/javascript'\n          }));\n        });\n      if (cssContentType.test(contentType))\n        return res.text()\n        .then(function (source) {\n          return new Response(new Blob([\n            'System.register([],function(e){return{execute:function(){var s=new CSSStyleSheet();s.replaceSync(' + JSON.stringify(source) + ');e(\"default\",s)}}})'\n          ], {\n            type: 'application/javascript'\n          }));\n        });\n      if (wasmContentType.test(contentType))\n        return (WebAssembly.compileStreaming ? WebAssembly.compileStreaming(res) : res.arrayBuffer().then(WebAssembly.compile))\n        .then(function (module) {\n          if (!global.System.wasmModules)\n            global.System.wasmModules = Object.create(null);\n          global.System.wasmModules[url] = module;\n          // we can only set imports if supported (eg early Safari doesnt support)\n          var deps = [];\n          var setterSources = [];\n          if (WebAssembly.Module.imports)\n            WebAssembly.Module.imports(module).forEach(function (impt) {\n              var key = JSON.stringify(impt.module);\n              if (deps.indexOf(key) === -1) {\n                deps.push(key);\n                setterSources.push('function(m){i[' + key + ']=m}');\n              }\n            });\n          return new Response(new Blob([\n            'System.register([' + deps.join(',') + '],function(e){var i={};return{setters:[' + setterSources.join(',') +\n            '],execute:function(){return WebAssembly.instantiate(System.wasmModules[' + JSON.stringify(url) +\n            '],i).then(function(m){e(m.exports)})}}})'\n          ], {\n            type: 'application/javascript'\n          }));\n        });\n      return res;\n    });\n  };\n})(typeof self !== 'undefined' ? self : global);\n"],"names":["global","systemJSPrototype","System","constructor","prototype","moduleTypesRegEx","shouldFetch","url","test","jsonContentType","cssContentType","wasmContentType","fetch","options","then","res","ok","contentType","headers","get","json","Response","Blob","JSON","stringify","type","text","source","WebAssembly","compileStreaming","arrayBuffer","compile","module","wasmModules","Object","create","deps","setterSources","Module","imports","forEach","impt","key","indexOf","push","join","self"],"mappings":"CAIA,SAAUA,GACR,IAAIC,EAAoBD,EAAOE,OAAOC,YAAYC,UAE9CC,EAAmB,0CACvBJ,EAAkBK,YAAc,SAAUC,GACxC,OAAOF,EAAiBG,KAAKD,IAG/B,IAAIE,EAAkB,0BAClBC,EAAiB,kBACjBC,EAAkB,0BAElBC,EAAQX,EAAkBW,MAC9BX,EAAkBW,MAAQ,SAAUL,EAAKM,GACvC,OAAOD,EAAML,EAAKM,GACjBC,MAAK,SAAUC,GACd,IAAKA,EAAIC,GACP,OAAOD,EACT,IAAIE,EAAcF,EAAIG,QAAQC,IAAI,gBAClC,OAAIV,EAAgBD,KAAKS,GAChBF,EAAIK,OACVN,MAAK,SAAUM,GACd,OAAO,IAAIC,SAAS,IAAIC,KAAK,CAC3B,wEAA0EC,KAAKC,UAAUJ,GAAQ,SAChG,CACDK,KAAM,+BAGRf,EAAeF,KAAKS,GACfF,EAAIW,OACVZ,MAAK,SAAUa,GACd,OAAO,IAAIN,SAAS,IAAIC,KAAK,CAC3B,oGAAsGC,KAAKC,UAAUG,GAAU,wBAC9H,CACDF,KAAM,+BAGRd,EAAgBH,KAAKS,IACfW,YAAYC,iBAAmBD,YAAYC,iBAAiBd,GAAOA,EAAIe,cAAchB,KAAKc,YAAYG,UAC7GjB,MAAK,SAAUkB,GACThC,EAAOE,OAAO+B,cACjBjC,EAAOE,OAAO+B,YAAcC,OAAOC,OAAO,OAC5CnC,EAAOE,OAAO+B,YAAY1B,GAAOyB,EAEjC,IAAII,EAAO,GACPC,EAAgB,GASpB,OARIT,YAAYU,OAAOC,SACrBX,YAAYU,OAAOC,QAAQP,GAAQQ,SAAQ,SAAUC,GACnD,IAAIC,EAAMnB,KAAKC,UAAUiB,EAAKT,SACH,IAAvBI,EAAKO,QAAQD,KACfN,EAAKQ,KAAKF,GACVL,EAAcO,KAAK,iBAAmBF,EAAM,YAG3C,IAAIrB,SAAS,IAAIC,KAAK,CAC3B,oBAAsBc,EAAKS,KAAK,KAAO,0CAA4CR,EAAcQ,KAAK,KACtG,0EAA4EtB,KAAKC,UAAUjB,GAC3F,4CACC,CACDkB,KAAM,+BAGLV,MA9Db,CAiEmB,oBAAT+B,KAAuBA,KAAO9C"}