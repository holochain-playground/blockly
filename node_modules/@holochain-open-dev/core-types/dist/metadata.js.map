{"version":3,"file":"metadata.js","sourceRoot":"","sources":["../src/metadata.ts"],"names":[],"mappings":"AAiCA,MAAM,UAAU,uBAAuB,CACrC,YAAwB;IAExB,IAAK,YAAmC,CAAC,QAAQ;QAC/C,OAAQ,YAAmC,CAAC,QAAQ,CAAC;IACvD,IAAK,YAAiC,CAAC,MAAM;QAC3C,OAAQ,YAAiC,CAAC,MAAM,CAAC;IACnD,IAAK,YAAiC,CAAC,MAAM;QAC3C,OAAQ,YAAiC,CAAC,MAAM,CAAC;IACnD,IAAK,YAAmC,CAAC,QAAQ;QAC/C,OAAQ,YAAmC,CAAC,QAAQ,CAAC;IACvD,OAAO,SAAS,CAAC;AACnB,CAAC;AA0BD,MAAM,CAAN,IAAY,WAKX;AALD,WAAY,WAAW;IACrB,+CAAK,CAAA;IACL,+CAAK,CAAA;IACL,iDAAM,CAAA;IACN,mDAAO,CAAA;AACT,CAAC,EALW,WAAW,KAAX,WAAW,QAKtB;AAOD,MAAM,CAAN,IAAY,cAgBX;AAhBD,WAAY,cAAc;IACxB,mDAAI,CAAA;IACJ,0DAA0D;IAC1D,mDAAI,CAAA;IACJ,uCAAuC;IACvC,yDAAO,CAAA;IACP,wEAAwE;IACxE,2DAAQ,CAAA;IACR,mFAAmF;IACnF,6DAAS,CAAA;IACT,8EAA8E;IAC9E,2DAAQ,CAAA;IACR,mFAAmF;IACnF,6DAAS,CAAA;IACT,kHAAkH;IAClH,uDAAM,CAAA;AACR,CAAC,EAhBW,cAAc,KAAd,cAAc,QAgBzB","sourcesContent":["import { Dictionary, Hash } from './common';\nimport { NewEntryHeader } from './header';\nimport { Timestamp } from './timestamp';\n\n// From https://github.com/holochain/holochain/blob/develop/crates/holochain/src/core/state/metadata.rs\n\nexport interface Metadata {\n  // Stores an array of headers indexed by entry hash\n  system_meta: Dictionary<SysMetaVal[]>;\n  link_meta: Array<{ key: LinkMetaKey; value: LinkMetaVal }>;\n  misc_meta: Dictionary<MiscMetaVal>;\n}\n\nexport type SysMetaVal =\n  | {\n      NewEntry: Hash;\n    }\n  | {\n      Update: Hash;\n    }\n  | {\n      Delete: Hash;\n    }\n  | {\n      Activity: Hash;\n    }\n  | {\n      DeleteLink: Hash;\n    }\n  | {\n      CustomPackage: Hash;\n    };\n\nexport function getSysMetaValHeaderHash(\n  sys_meta_val: SysMetaVal\n): Hash | undefined {\n  if ((sys_meta_val as { NewEntry: Hash }).NewEntry)\n    return (sys_meta_val as { NewEntry: Hash }).NewEntry;\n  if ((sys_meta_val as { Update: Hash }).Update)\n    return (sys_meta_val as { Update: Hash }).Update;\n  if ((sys_meta_val as { Delete: Hash }).Delete)\n    return (sys_meta_val as { Delete: Hash }).Delete;\n  if ((sys_meta_val as { Activity: Hash }).Activity)\n    return (sys_meta_val as { Activity: Hash }).Activity;\n  return undefined;\n}\n\nexport interface LinkMetaKey {\n  base: Hash;\n  zome_id: number;\n  tag: any;\n  header_hash: Hash;\n}\n\nexport interface LinkMetaVal {\n  link_add_hash: Hash;\n  target: Hash;\n  timestamp: Timestamp;\n  zome_id: number;\n  tag: any;\n}\n\nexport type MiscMetaVal =\n  | {\n      EntryStatus: EntryDhtStatus;\n    }\n  | 'StoreElement'\n  | { ChainItem: Timestamp }\n  | { ChainObserved: HighestObserved }\n  | { ChainStatus: ChainStatus };\n\nexport enum ChainStatus {\n  Empty,\n  Valid,\n  Forked,\n  Invalid,\n}\n\nexport interface HighestObserved {\n  header_seq: number;\n  hash: Hash[];\n}\n\nexport enum EntryDhtStatus {\n  Live,\n  /// This [Entry] has no headers that have not been deleted\n  Dead,\n  /// This [Entry] is awaiting validation\n  Pending,\n  /// This [Entry] has failed validation and will not be served by the DHT\n  Rejected,\n  /// This [Entry] has taken too long / too many resources to validate, so we gave up\n  Abandoned,\n  /// **not implemented** There has been a conflict when validating this [Entry]\n  Conflict,\n  /// **not implemented** The author has withdrawn their publication of this element.\n  Withdrawn,\n  /// **not implemented** We have agreed to drop this [Entry] content from the system. Header can stay with no entry\n  Purged,\n}\n\nexport interface CoreEntryDetails {\n  headers: NewEntryHeader[];\n  links: LinkMetaVal[];\n  dhtStatus: EntryDhtStatus;\n}\n"]}